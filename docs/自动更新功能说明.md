# 自动更新功能说明

## 功能概述

新增了后台自动版本检测功能，当有新版本发布时会在右上角显示红色提示，用户可选择更新或关闭提示。

## 功能特性

### 1. 后台自动检测
- 应用程序启动后5秒开始首次检测
- 之后每2小时自动检测一次更新
- 检测过程在后台进行，不影响正常使用

### 2. 更新提示
- 发现新版本时在右上角显示红色提示框
- 提示框包含版本信息和操作按钮
- 支持淡入淡出动画效果

### 3. 用户操作
- **更新按钮**：点击后切换到"关于"选项卡并开始下载更新
- **关闭按钮**：忽略此次更新提示
- **位置自适应**：提示框会根据窗体大小自动调整位置

## 使用方式

### 正常使用
1. 启动应用程序后，后台会自动开始检测更新
2. 如有新版本，右上角会显示红色提示
3. 点击"更新"按钮开始下载和安装
4. 点击"×"按钮忽略本次更新

### 调试模式 (仅开发人员)
- 按 `Ctrl+U` 可手动触发更新检测
- 状态栏会显示详细的检测信息

## 技术实现

### 核心组件
1. **BackgroundUpdateService**：后台更新检测服务
2. **UpdateNotificationControl**：更新提示控件
3. **AboutTabControl**：增强的更新功能

### 更新流程
1. 使用 GitHub API 检查最新版本
2. 比较当前版本和最新版本
3. 如有新版本，触发通知显示
4. 用户点击更新后，下载并安装新版本

### 安全特性
- 使用信号量防止重复检测
- 异常处理确保应用稳定运行
- 资源自动释放防止内存泄漏

## 注意事项

1. **网络连接**：需要网络连接才能检测更新
2. **API 限制**：GitHub API 有请求频率限制，检测失败时会自动重试
3. **权限要求**：更新安装可能需要管理员权限
4. **备份机制**：自动更新会备份当前版本以便恢复

## 自定义配置

可以通过修改以下参数来调整检测行为：

```csharp
// 在 MainForm.cs 的 Form1_Load 方法中
updateService?.Start(
    5000,      // 初始延迟（毫秒）
    7200000    // 检测间隔（毫秒，默认2小时）
);
```